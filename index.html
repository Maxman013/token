<!DOCTYPE html>
<html>
<head>
  <title>Bot Access Token Tool</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <meta charset="utf-8">
</head>
<body>
<div class="w3-container w3-cyan" onmouseover="hideBots()">
    <h1 style="text-align:center;cursor:pointer" onclick="href(-1)">Maximum Bots</h1>
</div>
<div class="w3-bar">
  <button class="w3-bar-item w3-button w3-light-blue" style="width:25%" onclick="href(0)" onmouseover="showBots()">Bots</button>
  <button class="w3-bar-item w3-button w3-light-blue" style="width:25%" onclick="href(1)" onmouseover="hideBots()">Access Token Tool</button>
  <button class="w3-bar-item w3-button w3-light-blue" style="width:25%" onclick="href(2)" onmouseover="hideBots()">Current Bot Issues</button>
  <button class="w3-bar-item w3-button w3-light-blue" style="width:25%" onclick="href(5)" onmouseover="hideBots()">Resolved Bot Issues</button>
</div>
<div id="botNav" class="w3-bar" style="display:none;">
    <button class="w3-bar-item w3-button w3-gray" onclick="href(3)" style="width:20%">PaintBot</button>
    <button class="w3-bar-item w3-button w3-gray" onclick="href(4)" style="width:20%">LossBot 12250</button>
    <button class="w3-bar-item w3-button w3-gray" onclick="href(6)" style="width:20%">CountryBot 0208</button>
    <button class="w3-bar-item w3-button w3-gray" onclick="href(7)" style="width:20%">CommentBot 2005</button>
    <button class="w3-bar-item w3-button w3-gray" onclick="href(8)" style="width:20%">BotoB 8008</button>
</div>

<div class="w3-container" onmouseover="hideBots()">
  <p>This is a tool designed to let you get an access token to allow a Facebook bot to autopost. You use this access token in your API requests for authentication purposes. The autoposting uses an app I created on Facebook developers called <b>BOT ACCESS TOKEN TOOL - Paintmin</b>. The access token you receive never expires, unless the account that logged in to the app in Step 1 or the page that is linked gets zucced.</p>
  <p>Currently the tool does not support pagination, I wanted to rewrite it so it looked a tad better before I added pagination support.</p>
</div>

<div class="w3-container" id="1c">
  <h1 class="w3-bold">Step 1 - Logging In</h1>
  <p>Click <b> <a class="w3-hover-text-blue" style="font-size:18px;" href="https://www.facebook.com/v3.1/dialog/oauth?client_id=164152187588420&redirect_uri=https%3A%2F%2Fwww.facebook.com%2Fconnect%2Flogin_success.html&scope=manage_pages%2Cpublish_pages%2Cpages_show_list&state=&response_type=token">here</a></b> to login to the app. Make sure you allow all permissions that have been requested, or else this whole process will not work.</p>
</div>

<div class="w3-container" id="2c">
  <h1 class="w3-bold">Step 2 - Obtaining User Access Token</h1>
  <p>As soon as you log in, copy the URL that you are redirected to (before you are redirected to <a style="font-family:Courier">https://www.facebook.com/connect/blank.html#_=_</a>) and paste it here (it should look a bit like <a style="font-family:Courier">https://www.facebook.com/connect/login_success.html#access_token=...</a>)</p>
  <form id="frm-user">
    <input id="in" type="text" style="font-family:Courier;width:100%;">
  </form>
  <p>Do not worry if you didn't do this in time before the URL changes. You can click the link in Step 1 again and it will redirect to the original link. Once you've done that, click this button:</p>
  <button onclick="getPages()">Complete Step 2</button>
  <p id="userT" style="font-family:Courier;"></p>
</div>

  <div class="w3-container" id="3c" style="display:none;">
    <h1 class="w3-bold">Step 3 - Select Page</h1>
    <p>Below is a table of pages you manage. Choose the page you would like an access token for.</p>
    <table id="pages" style="width:100%;">
    </table>
    <p id="pid" style="font-family:Courier;"></p>
  </div>

  <div class="w3-container" id="4c" style="display:none;">
    <h1 class="w3-bold">Done!</h1>
    <p>Your Extended Page Access Token is:</p>
    <input id="token" type="text" style="font-family:Courier;width:100%;" readonly>
  </div><br>
  
  <div class="w3-container">
    <p style="font-size:5px;">Copyright Â© 2019 Max Orchard. No access tokens generated using this tool are stored locally or externally. For a detailed explanation of how this tool works, you can visit <b class="w3-hover-text-blue" onclick="href(9)" style="cursor:pointer;">here</b> (WIP).</p>
  </div>

  <script>

      function showBots() {
          document.getElementById("botNav").style.display = "block";
      }
      
      function hideBots() {
          document.getElementById("botNav").style.display = "none";
      }
      
      function href(num) {
          var link = "https://maxman013.github.io/";
          switch (num) {
          case 0:
              link += "bots";
              break;
          case 1:
              link += "token";
              break;
          case 2:
              link += "issues";
              break;
          case 3:
              link += "paintbot";
              break;
          case 4:
              link += "lossbot";
              break;
          case 5:
              link += "resolved";
              break;
          case 6:
              link += "countrybot";
              break;
          case 7:
              link += "commentbot";
              break;
          case 8:
              link += "botob";
              break;
          case 9:
              link += "toolworks";
              break;
          }
          
          window.open(link, "_self");
      }
      
      var pageInfo = []; //stores page info
      var counter = 0; //counts pages
      
      //function runs when completing Step 2
      function getPages() {
          var url = document.getElementById("in").value;
          var userToken = url.substring(65, url.indexOf("&")); //obtain user token
          document.getElementById("userT").innerHTML = `User Token: ${userToken.substring(0, 20)}...`;
          var req = new XMLHttpRequest(); //init http request
          req.open("GET", `https://graph.facebook.com/me/accounts?access_token=${userToken}`, false);
          req.send();
          //if returned HTTP 200, continue, else display error
          if (req.status == 200) {
              var raw = JSON.parse(req.responseText).data;
              for (i = 0 ; i < raw.length ; i++) {
                  var temp = [];
                  temp.push(raw[i].name);
                  temp.push(raw[i].id);
                  temp.push(raw[i].access_token);
                  pageInfo.push(temp);
                  counter++;
              }
              for (i = 0 ; i < counter ; i++) {
                  document.getElementById("pages").innerHTML += `<input type="radio" name="pages" id="${i}"> ${pageInfo[i][0]}<br>`;
              }
              document.getElementById("pages").innerHTML += '<br><button onclick="getToken()">Complete Step 3</button>';
              document.getElementById("3c").style.display = "block";
          } else {
              document.getElementById("in").value = `ERROR ${req.status} - Try again`;
          }
      }
      
      //function runs when completing Step 3
      function getToken() {
          var pageShortToken = "",
              pageID = "";
          //get page short-lived token and id for selected page
          for (i = 0 ; i < counter ; i++) {
              if (document.getElementById(i).checked) {
                  pageShortToken = pageInfo[i][2];
                  pageID = pageInfo[i][1];
                  break;
              }
          }
          document.getElementById("pid").innerHTML = `Page ID: ${pageID}<br>Page Short Token: ${pageShortToken.substring(0, 20)}...<br>`;
          var req = new XMLHttpRequest();
          req.open("GET", `https://graph.facebook.com/oauth/access_token?grant_type=fb_exchange_token&client_id=164152187588420&client_secret=e9389daf7e2cf7d3a99fcdb7bdf739d3&fb_exchange_token=${pageShortToken}`, false);
          req.send();
          //if returned HTTP 200, continue, else display error
          if (req.status == 200) {
              //get page long-lived token
              var pageLongToken = JSON.parse(req.responseText).access_token;
              document.getElementById("pid").innerHTML += `Page Long Token: ${pageLongToken.substring(0, 20)}...`;
              req.open("GET", `https://graph.facebook.com/${pageID}?fields=access_token&access_token=${pageLongToken}`, false);
              req.send();
              //if returned HTTP 200, continue, else display error
              if (req.status == 200) {
                  var pageExtToken = JSON.parse(req.responseText).access_token;
                  document.getElementById("token").value = pageExtToken;
                  document.getElementById("4c").style.display = "block";
              } else {
                  document.getElementById("token").value = `ERROR ${req.status} - Try again`;
                  document.getElementById("4c").style.display = "block";
              }
          } else {
              document.getElementById("token").value = `ERROR ${req.status} - Try again`;
              document.getElementById("4c").style.display = "block";
          }
      }
  </script>
</body>
</html>